{{ define "title" }} Convox {{ end }}

{{ define "body" }}

  {{ $cluster := . }}

	<div id="alert" class="alert alert-danger  alert-dismissible" role="alert" style="display:none;">
		<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<strong>Error:</strong><span class="message"></span>
	</div>

	<ol class="breadcrumb">
		<button id="destroy-cluster" class="btn btn-danger btn-xs trackable">Destroy Cluster</button>
		<li class="active">{{ .Name }}</li>
	</ol>

	<div class="panel panel-default">
		<div class="panel-body">
			{{ label "Status" .Status }}
			{{ label "Size" .Size }}
			{{ label "Count" .Count }}
		</div>
	</div>

	{{ if .Created }}

		<div class="table-title">
			<table class="table table-striped table-bordered">
				<thead>
					<tr class="title">
						<th colspan="5">
							<button class="btn btn-success btn-xs pull-right" data-toggle="modal" data-target="#app-create">Create App</button>
							Apps
						</th>
					</tr>
					<tr>
						<th class="expand">Name</th>
						<th>Status</th>
						<th>CPU</th>
						<th>Memory</th>
						<th>Disk</th>
					</tr>
				</thead>
				<tbody>
					{{ range .Apps }}
						<tr>
							<td class="meta-buttons">
								<a href="/apps/{{ .Name }}">
									{{ .Name }}
								</a>
							</td>
							<td>{{ .Status }}</td>
							{{ $metrics := .Metrics }}
							<td>{{ meter "cpu"    $metrics.Cpu    100 }}</td>
							<td>{{ meter "memory" $metrics.Memory 100 }}</td>
							<td>{{ meter "disk"   $metrics.Disk   100 }}</td>
						</tr>
					{{ end }}
				</tbody>
			</table>
		</div>

	{{ end }}

	<div class="modal fade" id="app-create" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form method="post" action="/apps" class="form-horizontal">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">Create App</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="app-cluster" class="col-sm-3 control-label">Cluster</label>
							<div class="col-sm-8">
								<input name="cluster" type="text" class="form-control" id="app-cluster" readonly value="{{ .Name }}">
							</div>
						</div>
						<div class="form-group">
							<label for="app-name" class="col-sm-3 control-label">App Name</label>
							<div class="col-sm-8">
								<input name="name" type="text" class="form-control" id="app-name">
							</div>
						</div>
						<div class="form-group">
							<label for="app-repo" class="col-sm-3 control-label">Git Repository</label>
							<div class="col-sm-8">
								<input name="repo" type="text" class="form-control" id="app-repo" value="https://github.com/convox-examples/sinatra.git">
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
						<input type="submit" class="btn btn-primary" value="Create App">
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
		$('#destroy-cluster').on('click', function() {
			$.ajax({ type: 'DELETE', url:'/clusters/{{ .Name }}'}).done(function(msg) {
				window.location = '/clusters';
			}).fail(function(msg) {
				$('#alert .message').html(msg.responseText);
				$('#alert').show();
			});
		});

                mixpanel.track('page-viewed', {
                        'page name' : 'cluster',
                        'url' : window.location.pathname
                });
	</script>
{{ end }}
