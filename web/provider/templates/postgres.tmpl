{{ define "env" }}
	  { "Fn::Join": [ "=", [ "POSTGRES_PORT_5432_TCP_ADDR", { "Fn::GetAtt": [ "{{ .Name }}", "Endpoint.Address" ] } ] ] },
		{ "Fn::Join": [ "=", [ "POSTGRES_PORT_5432_TCP_PORT", { "Fn::GetAtt": [ "{{ .Name }}", "Endpoint.Port"		] } ] ] },
	"POSTGRES_ENV_POSTGRES_USER=app",
	"POSTGRES_ENV_POSTGRES_PASSWORD=password",
	"POSTGRES_ENV_POSTGRES_DATABASE=app",
{{ end }}

{{ define "formation" }}
	"{{ .Name }}Security": {
		"Type": "AWS::EC2::SecurityGroup",
		"Properties": {
			"GroupDescription": "{{ .Name }}",
			"SecurityGroupIngress": [
				{ "IpProtocol": "tcp", "FromPort": "5432", "ToPort": "5432", "CidrIp": "{{ .Cidr }}" }
			],
			"VpcId": "{{ .Vpc }}"
		}
	},
	"{{ .Name }}SubnetGroup": {
		"Type": "AWS::RDS::DBSubnetGroup",
		"Properties": {
			"DBSubnetGroupDescription": "{{ .Name }}",
			"SubnetIds": [
				{ "Ref": "Subnet0" },
				{ "Ref": "Subnet1" },
				{ "Ref": "Subnet2" },
				{ "Ref": "Subnet3" }
			]
		}
	},
	"{{ .Name }}": {
		"Type": "AWS::RDS::DBInstance",
		"Properties": {
			"AllocatedStorage": "10",
			"DBInstanceClass": "db.t2.micro",
			"DBName": "app",
			"DBSubnetGroupName": { "Ref": "{{ .Name }}SubnetGroup" },
			"Engine": "postgres",
			"MasterUsername": "app",
			"MasterUserPassword": "password",
			"Port": "5432",
			"StorageType": "gp2",
			"VPCSecurityGroups": [ { "Ref": "{{ .Name }}Security" } ]
		}
	},
{{ end }}
