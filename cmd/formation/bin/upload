#!/bin/sh

create_function() {
  aws lambda create-function \
    --function-name formation \
    --runtime nodejs \
    --role $ROLE \
    --handler lambda.external \
    --zip-file fileb://lambda.zip
}

update_function() {
  aws lambda update-function-code \
    --function-name formation \
    --zip-file fileb://lambda.zip
}

if [ "$ROLE" == "" ]; then
  echo "ROLE required"
  exit 1
fi

aws lambda get-function --function-name formation >/dev/null 2>&1 && update_function || create_function
aws s3 cp lambda.zip s3://convox/lambda-formation.zip --acl public-read
